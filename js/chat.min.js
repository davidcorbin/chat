function send(a){if(""==document.getElementById("sendbutton").value)return!1;var b=$(a).attr("action"),c=$("#chatmes").serializeArray();return $.ajax({url:b,data:c,type:"post",success:function(){document.getElementById("sendbutton").value="",get()}}),!1}function get(){var a=document.getElementById("newchat").value;return window.location.replace(window.location.href.split("#")[0]+"#"+a),""==prevchatname?prevchatname=a:prevchatname!=a&&($(".chat").html(""),latestpost=-1,numofposts=0,prevchatname=a),$.ajax({url:"chatupdate",data:{chatpage:a,latestpost:latestpost},type:"get",cache:"false",success:function(b){if("create"==b)$("#chattitle").text("Chat not found"),$(".chat").html("<p>This chat doesn't exist. Would you like to create it?</p><button class='btn btn-default' onclick='createchat()'>Yes</button>");else if("no"==b)$("#chattitle").text("Chat can't be created"),$(".chat").html("<p>This chat can't be created.</p>");else{$("#chattitle").text("#"+a);for(var c=JSON.parse(b),d=0;d<c.length;d++)1==c[d].me?($("<li></li>",{"class":"right clearfix "+numofposts}).prependTo(".chat"),$("<span></span>",{"class":"chat-img pull-right"}).appendTo("."+numofposts.toString())):($("<li></li>",{"class":"left clearfix "+numofposts}).prependTo(".chat"),$("<span></span>",{"class":"chat-img pull-left"}).appendTo("."+numofposts.toString())),$("<a></a>",{"data-toggle":"modal","data-target":"#profileView","data-user":c[d].user}).appendTo("."+numofposts.toString()+" span"),$("<img />",{src:c[d].avatar,alt:"Profile Image","class":"img-circle avatar"}).appendTo("."+numofposts.toString()+" span a"),$("<div class='chat-body clearfix'><div class='header'>").appendTo("."+numofposts.toString()),$("<strong>"+c[d].user+"</strong>",{"class":"primary-font"}).appendTo("."+numofposts.toString()+" div.chat-body div.header"),$('<small class="pull-right text-muted"><span class="glyphicon glyphicon-time"></span>'+c[d].date+"</small></div>").appendTo("."+numofposts.toString()+" div.chat-body div.header"),$("<p>"+c[d].data+"</p></div></li>").appendTo("."+numofposts.toString()+" div.chat-body div.header"),parseInt(c[d].id)>latestpost&&(latestpost=parseInt(c[d].id)),numofposts++;document.getElementById("currentchat").value=a}}}),!1}function createchat(){var a=$("#newchat").serializeArray();return $.ajax({url:"chat",data:a,type:"post",success:function(a){"1"==a&&chat_create_error("No chat name given"),"created"==a&&chat_create_success(),get()}}),!1}function chat_create_error(a){$("#newchatfeedback").removeClass("has-success"),$("#newchatfeedback").removeClass("has-success"),$("#newchatfeedback").addClass("has-error"),$("#chatfeedback").html(a)}function chat_create_success(){$("#newchatfeedback").removeClass("has-success"),$("#newchatfeedback").removeClass("has-error"),$("#newchatfeedback").addClass("has-success")}function chat_create_default(){$("#newchatfeedback").removeClass("has-success"),$("#newchatfeedback").removeClass("has-success"),$("#newchatfeedback").removeClass("has-error")}function loadProfile(a){var b=$(a.relatedTarget),c=b.data("user"),d=$(".modal");$.get("profile/"+c,function(a){var c,b=document.querySelectorAll(".modal-body p");for(c=0;c<b.length;++c)b[c].style.display="block";var d=JSON.parse(a);document.querySelector("#profileav").src=d.avat,"0"==d.team&&(document.querySelector("#profileteamwrap").style.display="none"),""==d.pos&&(document.querySelector("#profileposwrap").style.display="none"),""==d.loc&&(document.querySelector("#profilelocwrap").style.display="none"),""==d.site&&(document.querySelector("#profilesitewrap").style.display="none"),document.querySelector("#profileteam").textContent=d.team,document.querySelector("#profilepos").textContent=d.pos,document.querySelector("#profileloc").textContent=d.loc,document.querySelector("#profilesite").textContent=d.site,document.querySelector("#profilesite").href=d.site,document.querySelector("#profilecreatedat").textContent=d.createat,document.querySelector("#profileviews").textContent=d.views,document.querySelector("#profileposts").textContent=d.posts}),d.find(".modal-title").text(c)}function initChatInput(){window.location.hash&&(document.getElementById("newchat").value=window.location.hash.substring(1))}window.onload=function(){$("#profileView").on("show.bs.modal",function(a){loadProfile(a)}),$(window).on("hashchange",function(){document.getElementById("newchat").value=window.location.hash.substring(1),get()}),initChatInput(),get()},setInterval(function(){get()},3e3);var numofposts=0,latestpost=-1,prevchatname="";
